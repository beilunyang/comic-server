{"version":3,"sources":["../../src/routes/user.js"],"names":["router","post","ctx","console","log","record","request","body","mid","pid","cover","title","openid","state","findOneAndUpdate","upsert","status","message","throw","get","Number","params","isNaN","findOne","select","find","limit","collection","save"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA,MAAMA,SAAS,yBAAf;;AAEAA,OAAOC,IAAP,CAAY,SAAZ,EAAuB,MAAOC,GAAP,IAAe;AACpCC,UAAQC,GAAR,CAAY,mBAAZ;AACA,QAAMC,SAASH,IAAII,OAAJ,CAAYC,IAA3B;AACA,MAAIF,MAAJ,EAAY;AACV,UAAM,EAAEG,GAAF,EAAOC,GAAP,EAAYC,KAAZ,EAAmBC,KAAnB,KAA6BN,MAAnC;AACA,UAAMO,SAASV,IAAIW,KAAJ,CAAUD,MAAzB;AACA,UAAM,eAAOE,gBAAP,CAAwB,EAAEN,GAAF,EAAxB,EAAiC,EAAEI,MAAF,EAAUJ,GAAV,EAAeC,GAAf,EAAoBC,KAApB,EAA2BC,KAA3B,EAAjC,EAAqE,EAAEI,QAAQ,IAAV,EAArE,CAAN;AACAb,QAAIK,IAAJ,GAAW;AACTS,cAAQ,IADC;AAETC,eAAS;AAFA,KAAX;AAID,GARD,MAQO;AACLf,QAAIgB,KAAJ,CAAU,GAAV,EAAe,QAAf;AACD;AACF,CAdD;;AAgBAlB,OAAOmB,GAAP,CAAW,cAAX,EAA2B,MAAOjB,GAAP,IAAe;AACxCC,UAAQC,GAAR,CAAY,4BAAZ;AACA,QAAMQ,SAASV,IAAIW,KAAJ,CAAUD,MAAzB;AACA,QAAMJ,MAAMY,OAAOlB,IAAImB,MAAJ,CAAWb,GAAlB,CAAZ;AACA,MAAIc,MAAMd,GAAN,CAAJ,EAAgB;AACd,WAAON,IAAIgB,KAAJ,CAAU,GAAV,EAAe,QAAf,CAAP;AACD;AACDhB,MAAIK,IAAJ,GAAW,MAAM,eAAOgB,OAAP,CAAe,EAAEX,MAAF,EAAUJ,GAAV,EAAf,EAAgCgB,MAAhC,CAAuC,gBAAvC,CAAjB;AACD,CARD;;AAUAxB,OAAOmB,GAAP,CAAW,SAAX,EAAsB,MAAOjB,GAAP,IAAe;AACnCC,UAAQC,GAAR,CAAY,kBAAZ;AACA,QAAMQ,SAASV,IAAIW,KAAJ,CAAUD,MAAzB;AACAV,MAAIK,IAAJ,GAAW,MAAM,eAAOkB,IAAP,CAAY,EAAEb,MAAF,EAAZ,EAAwBc,KAAxB,CAA8B,EAA9B,EAAkCF,MAAlC,CAAyC,WAAzC,CAAjB;AACD,CAJD;;AAMAxB,OAAOC,IAAP,CAAY,aAAZ,EAA2B,MAAOC,GAAP,IAAe;AACxCC,UAAQC,GAAR,CAAY,kBAAZ;AACA,QAAMuB,aAAazB,IAAII,OAAJ,CAAYC,IAA/B;AACA,MAAIoB,UAAJ,EAAgB;AACd,UAAM,EAAEhB,KAAF,EAASH,GAAT,EAAcE,KAAd,KAAwBiB,UAA9B;AACA,UAAMf,SAASV,IAAIW,KAAJ,CAAUD,MAAzB;AACA,UAAM,mBAAWgB,IAAX,CAAgB,EAAEhB,MAAF,EAAUD,KAAV,EAAiBH,GAAjB,EAAsBE,KAAtB,EAAhB,CAAN;AACAR,QAAIK,IAAJ,GAAW;AACTS,cAAQ,IADC;AAETC,eAAS;AAFA,KAAX;AAID,GARD,MAQO;AACLf,QAAIgB,KAAJ,CAAU,GAAV,EAAe,QAAf;AACD;AACF,CAdD;;AAgBAlB,OAAOmB,GAAP,CAAW,aAAX,EAA0B,MAAOjB,GAAP,IAAe;AACvCC,UAAQC,GAAR,CAAY,iBAAZ;AACA,QAAMQ,SAASV,IAAIW,KAAJ,CAAUD,MAAzB;AACAV,MAAIK,IAAJ,GAAW,MAAM,mBAAWkB,IAAX,CAAgB,EAAEb,MAAF,EAAhB,EAA4BY,MAA5B,CAAmC,WAAnC,CAAjB;AACD,CAJD;;kBAMexB,M","file":"user.js","sourcesContent":["import Router from 'koa-router';\nimport { Record, Collection } from '../models';\n\nconst router = new Router();\n\nrouter.post('/record', async (ctx) => {\n  console.log('add a read record');\n  const record = ctx.request.body;\n  if (record) {\n    const { mid, pid, cover, title } = record;\n    const openid = ctx.state.openid;\n    await Record.findOneAndUpdate({ mid }, { openid, mid, pid, cover, title }, { upsert: true });\n    ctx.body = {\n      status: 'ok',\n      message: '新增阅读记录成功',\n    };\n  } else {\n    ctx.throw(400, '内容不能为空');\n  }\n});\n\nrouter.get('/record/:mid', async (ctx) => {\n  console.log('get read record some comic');\n  const openid = ctx.state.openid;\n  const mid = Number(ctx.params.mid);\n  if (isNaN(mid)) {\n    return ctx.throw(400, '无效的mid');\n  }\n  ctx.body = await Record.findOne({ openid, mid }).select('-_id pid title');\n});\n\nrouter.get('/record', async (ctx) => {\n  console.log('get read records');\n  const openid = ctx.state.openid;\n  ctx.body = await Record.find({ openid }).limit(30).select('-_id -__v');\n});\n\nrouter.post('/collection', async (ctx) => {\n  console.log('add a collection');\n  const collection = ctx.request.body;\n  if (collection) {\n    const { title, mid, cover } = collection;\n    const openid = ctx.state.openid;\n    await Collection.save({ openid, title, mid, cover });\n    ctx.body = {\n      status: 'ok',\n      message: '收藏成功',\n    };\n  } else {\n    ctx.throw(400, '内容不能为空');\n  }\n});\n\nrouter.get('/collection', async (ctx) => {\n  console.log('get collections');\n  const openid = ctx.state.openid;\n  ctx.body = await Collection.find({ openid }).select('-__id -_v');\n});\n\nexport default router;\n"]}